<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÄ‡∏Å‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤‡∏õ‡∏π‡∏õ‡∏•‡∏≤ | GoldoraX</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700&display=swap');
  body { 
    font-family: 'Prompt', sans-serif; 
    /* Deep Space Gradient */
    background: linear-gradient(180deg, #020024 0%, #000045 35%, #080064 100%); 
    color: #fff; 
    text-align: center; 
    min-height: 100vh; 
    margin: 0; 
    padding-top: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    color: #00ffff; /* Neon Cyan */
    text-shadow: 0 0 15px rgba(0, 255, 255, 0.8), 0 0 5px rgba(255, 255, 255, 0.5);
    margin-bottom: 10px;
    font-size: 2.8rem;
  }
  header { 
    width: 90%;
    max-width: 600px;
    margin-bottom: 10px;
    /* Glassmorphism/Dark UI background */
    background: rgba(17, 0, 92, 0.5); 
    backdrop-filter: blur(5px);
    padding: 15px;
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
  }
  .user-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1.1rem;
    padding: 5px 0;
  }
  .username-display {
    color: #ffd700;
    font-weight: bold;
  }
  .balance-display {
    color: #76ff03; /* Neon Green */
    font-weight: bold;
    font-size: 1.5rem;
  }

  /* Action Buttons for LINE OA */
  .action-buttons {
    display: flex;
    justify-content: space-around;
    width: 90%;
    max-width: 500px;
    margin: 10px auto 20px auto;
  }
  .action-btn {
    border: none;
    padding: 10px 20px;
    font-size: 1rem;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    width: 45%;
    transform: translateY(0);
  }
  .deposit-btn {
    background: linear-gradient(45deg, #76ff03, #388e3c);
    color: #000;
    box-shadow: 0 4px 0 #1b5e20, 0 0 15px #76ff03;
  }
  .deposit-btn:hover {
    background: linear-gradient(45deg, #aeff03, #66bb6a);
    transform: translateY(-4px);
    box-shadow: 0 4px 0 #1b5e20, 0 0 25px #76ff03;
  }
  .withdraw-btn {
    background: linear-gradient(45deg, #ff5757, #c62828);
    color: white;
    box-shadow: 0 4px 0 #8c0000, 0 0 15px #ff5757;
  }
  .withdraw-btn:hover {
    background: linear-gradient(45deg, #ff8a80, #ef5350);
    transform: translateY(-4px);
    box-shadow: 0 4px 0 #8c0000, 0 0 25px #ff5757;
  }
  /* End Action Buttons */


  /* Animal Selection Area */
  .animals {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    width: 90%;
    max-width: 500px;
    margin: 20px auto;
  }
  
  /* --- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÅ‡∏ö‡∏ö 3D ‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà --- */
  .animal-btn {
    padding: 18px;
    /* Gradient background for metallic look */
    background: linear-gradient(135deg, #1c0082, #0b0047); 
    border: none;
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Smooth transition */
    font-size: 3rem;
    line-height: 1;
    /* 3D/Floating Effect - ‡∏•‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
    transform: translateY(-2px); 
    box-shadow: 
        0 5px 0 0 #08003d, /* Deep shadow for dimension */
        inset 0 0 10px rgba(255, 255, 255, 0.1), /* Inner highlight for gloss */
        0 10px 20px rgba(0, 0, 0, 0.9); /* Standard shadow */
  }
  .animal-btn span {
      display: block;
      font-size: 1.1rem; 
      color: #ff99ff;
      margin-top: 8px;
      font-weight: 600;
  }
  .animal-btn:hover {
    /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡πÄ‡∏°‡∏≤‡∏™‡πå */
    transform: translateY(-8px) scale(1.08); /* Lift and scale more dramatically */
    box-shadow: 
        0 4px 0 #05002b, /* Adjusted deep shadow */
        0 18px 30px rgba(0, 0, 0, 1.2),
        0 0 35px #00ffff; /* Brighter Cyan Glow */
  }
  .animal-btn.selected {
    /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å - Gradient ‡∏™‡∏µ‡∏ó‡∏≠‡∏á */
    background: linear-gradient(135deg, gold, #ffec85); /* Gold gradient */
    border-color: transparent;
    transform: translateY(-4px); 
    box-shadow: 
        0 2px 0 #b8860b, /* Darker gold shadow */
        0 0 40px gold,
        0 0 70px rgba(255, 215, 0, 0.7); /* Wide gold glow */
  }
  /* --- ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÅ‡∏ö‡∏ö 3D ‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà --- */


  /* Controls Area */
  .controls {
    /* Glassmorphism/Dark UI background */
    background: rgba(11, 0, 71, 0.6);
    backdrop-filter: blur(5px);
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.8), 0 0 5px #ff99ff; /* Shadow with pink highlight */
    width: 90%;
    max-width: 600px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ä‡∏¥‡∏õ */
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  .dice-area {
    font-size: 4rem; /* ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
    margin: 15px 0;
    min-height: 60px;
    font-weight: bold;
    color: #00ffff; /* Neon Cyan */
    text-shadow: 0 0 10px #00ffff;
  }
  .result-area {
    min-height: 30px;
    margin-bottom: 15px;
    font-size: 1.6rem;
    font-weight: bold;
    color: #76ff03; /* Neon Green */
    text-shadow: 0 0 8px #76ff03;
  }

  /* Chip Buttons Styling */
  .chip-buttons {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 15px;
    flex-wrap: wrap; /* ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
  }
  .chip-btn {
    background: linear-gradient(45deg, #ffd700, #ffec85);
    color: #1a0033;
    border: 2px solid #b8860b;
    border-radius: 50%; /* ‡∏ß‡∏á‡∏Å‡∏•‡∏° */
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 3px 0 #b8860b, 0 0 10px gold;
  }
  .chip-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 0 #b8860b, 0 0 15px gold;
  }
  /* End Chip Buttons Styling */

  input[type="number"] {
    width: 150px;
    padding: 10px;
    border-radius: 20px;
    border: 2px solid gold;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    font-size: 16px;
    text-align: center;
    margin-right: 10px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
  }
  #roll {
    /* Gold Gradient Roll Button */
    background: linear-gradient(45deg, gold, #ffec85);
    border: none;
    padding: 12px 30px;
    font-size: 1.2rem;
    border-radius: 25px;
    font-weight: bold;
    color: #1a0033;
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 0 4px 0 #b8860b, 0 0 20px gold; /* 3D Shadow + Glow */
    transform: translateY(-2px);
  }
  #roll:hover {
    box-shadow: 0 4px 0 #b8860b, 0 0 30px gold; /* Enhance glow on hover */
    transform: translateY(-5px) scale(1.05);
  }
  #roll:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: translateY(0);
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
  }

  /* Modal/Message Box Styling */
  .modal {
      display: none; 
      position: fixed; 
      z-index: 1000; 
      left: 0;
      top: 0;
      width: 100%; 
      height: 100%; 
      overflow: auto; 
      background-color: rgba(0,0,0,0.7); 
      padding-top: 150px;
  }
  .modal-content {
      background-color: #1a0066;
      margin: 5% auto; 
      padding: 30px;
      border: 3px solid #00ffff; /* Neon border */
      width: 80%; 
      max-width: 350px;
      border-radius: 15px;
      box-shadow: 0 0 25px #00ffff;
      color: white;
      text-align: center;
  }
  .modal-content button {
      margin-top: 20px;
      background: #00ffff; /* Neon Cyan Button */
      color: #1a0033;
      font-weight: bold;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 0 10px #00ffff;
  }
  .modal-content button:hover {
      box-shadow: 0 0 20px #00ffff;
  }
</style>
</head>
<body>

  <!-- Modal/Message Box --><div id="messageModal" class="modal">
    <div class="modal-content">
      <p id="modalMessage"></p>
      <button onclick="closeModal()">‡∏ï‡∏Å‡∏•‡∏á</button>
    </div>
  </div>

  <h1>‡πÄ‡∏Å‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤‡∏õ‡∏π‡∏õ‡∏•‡∏≤</h1>

  <header>
    <div class="user-info">
      <div>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: <span id="usernameDisplay" class="username-display">...</span></div>
      <div>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô: <span id="balanceDisplay" class="balance-display">0 üí∞</span></div>
    </div>
  </header>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ù‡∏≤‡∏Å/‡∏ñ‡∏≠‡∏ô ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE OA --><div class="action-buttons">
      <button onclick="window.location.href='https://lin.ee/Mm1caQx'" class="action-btn deposit-btn">
          üí∞ ‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô
      </button>
      <button onclick="window.location.href='https://lin.ee/Mm1caQx'" class="action-btn withdraw-btn">
          üí≥ ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
      </button>
  </div>
  <!-- ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î ‡∏õ‡∏∏‡πà‡∏°‡∏ù‡∏≤‡∏Å/‡∏ñ‡∏≠‡∏ô --><div class="animals">
    <div class="animal-btn" data-animal="‡∏õ‡∏•‡∏≤">üêü <span>‡∏õ‡∏•‡∏≤</span></div>
    <div class="animal-btn" data-animal="‡∏Å‡∏∏‡πâ‡∏á">ü¶ê <span>‡∏Å‡∏∏‡πâ‡∏á</span></div>
    <div class="animal-btn" data-animal="‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤">üçà <span>‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤</span></div>
    <div class="animal-btn" data-animal="‡πÄ‡∏™‡∏∑‡∏≠">üêØ <span>‡πÄ‡∏™‡∏∑‡∏≠</span></div> 
    <div class="animal-btn" data-animal="‡∏õ‡∏π">ü¶Ä <span>‡∏õ‡∏π</span></div>
    <div class="animal-btn" data-animal="‡πÑ‡∏Å‡πà">üêì <span>‡πÑ‡∏Å‡πà</span></div>
  </div>

  <div class="controls">
    <div class="dice-area" id="diceArea">...</div>
    <div class="result-area" id="result">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô!</div>
    
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ä‡∏¥‡∏õ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà -->
    <div class="chip-buttons">
        <button class="chip-btn" data-amount="50">50</button>
        <button class="chip-btn" data-amount="100">100</button>
        <button class="chip-btn" data-amount="200">200</button>
        <button class="chip-btn" data-amount="500">500</button>
        <button class="chip-btn" data-amount="1000">1000</button>
    </div>
    
    <div style="display: flex; justify-content: center; align-items: center;">
        <input type="number" id="betAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô" value="100" min="10">
        <button id="roll">‡∏´‡∏°‡∏∏‡∏ô!</button>
    </div>
  </div>

  <a href="index_Version8.html" style="margin-top: 20px; color: #ccc; text-decoration: none;">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>

  <script type="module">
    // ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // ‡∏£‡∏´‡∏±‡∏™ Configuration Keys ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå GoldoraX-Game
    const firebaseConfig = {
      apiKey: "AIzaSyACTSU6LYObSv5gEAfKJt4Yr4LaCCAkQvw",
      authDomain: "goldorax-game.firebaseapp.com",
      projectId: "goldorax-game",
      storageBucket: "goldorax-game.firebasestorage.app",
      messagingSenderId: "601999451419",
      appId: "1:601999451419:web:f0782a8437b493eb8f5fbe",
      measurementId: "G-09PW99QK06"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ************************
    // *** GLOBAL VARIABLES ***
    // ************************
    let currentUsername = null;
    let balance = 0;

    const animals = ['‡∏õ‡∏•‡∏≤', '‡∏Å‡∏∏‡πâ‡∏á', '‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤', '‡πÄ‡∏™‡∏∑‡∏≠', '‡∏õ‡∏π', '‡πÑ‡∏Å‡πà'];
    const emojis = ['üêü', 'ü¶ê', 'üçà', 'üêØ', 'ü¶Ä', 'üêì'];
    const selected = new Set();
    const balanceDisplay = document.getElementById('balanceDisplay');
    const usernameDisplay = document.getElementById('usernameDisplay');
    const betInput = document.getElementById('betAmount');
    const diceArea = document.getElementById('diceArea');
    const result = document.getElementById('result');
    const rollButton = document.getElementById('roll');

    // *************************
    // *** MODAL FUNCTIONS ***
    // *************************
    const messageModal = document.getElementById('messageModal');
    const modalMessage = document.getElementById('modalMessage');
    
    function showModal(message) {
        modalMessage.textContent = message;
        messageModal.style.display = 'block';
    }

    window.closeModal = function() {
        messageModal.style.display = 'none';
    }

    // ************************
    // *** FIREBASE & AUTH ***
    // ************************

    // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    document.addEventListener('DOMContentLoaded', async () => {
        currentUsername = sessionStorage.getItem('currentUsername');

        if (!currentUsername) {
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡πÉ‡∏´‡πâredirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login
            showModal('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°');
            setTimeout(() => {
                window.location.href = 'login_Version4.html';
            }, 2000);
            return;
        }

        usernameDisplay.textContent = currentUsername;
        await loadBalance();

        // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå
        document.querySelectorAll('.animal-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const animal = btn.getAttribute('data-animal');
                if (selected.has(animal)) {
                    selected.delete(animal);
                    btn.classList.remove('selected');
                } else {
                    if (selected.size < 3) {
                        selected.add(animal);
                        btn.classList.add('selected');
                    } else {
                        showModal('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏ï‡∏±‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!');
                    }
                }
            });
        });
        
        // ** NEW: Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ä‡∏¥‡∏õ **
        document.querySelectorAll('.chip-btn').forEach(chip => {
            chip.addEventListener('click', () => {
                const amount = chip.getAttribute('data-amount');
                betInput.value = amount;
            });
        });
    });

    // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô
    async function loadBalance() {
        if (!currentUsername) return;

        try {
            const userRef = doc(db, "players", currentUsername);
            const docSnap = await getDoc(userRef);

            if (docSnap.exists()) {
                balance = docSnap.data().balance || 0;
            } else {
                // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÑ‡∏°‡πà‡∏ô‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤ login ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß)
                balance = 0;
            }
            balanceDisplay.textContent = balance.toLocaleString() + ' üí∞';
        } catch (error) {
            console.error("Error loading balance:", error);
            showModal('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô!');
        }
    }

    async function saveBalance(newBalance) {
        if (!currentUsername) return;

        try {
            const userRef = doc(db, "players", currentUsername);
            await updateDoc(userRef, {
                balance: newBalance
            });
            balance = newBalance;
            balanceDisplay.textContent = balance.toLocaleString() + ' üí∞';
        } catch (error) {
            console.error("Error saving balance:", error);
            showModal('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô!');
            // ‡∏´‡∏≤‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏Ñ‡∏ß‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
            await loadBalance(); 
        }
    }

    // *************************
    // *** GAME LOGIC ***
    // *************************

    rollButton.addEventListener('click', async () => {
        const betAmount = parseInt(betInput.value);

        if (isNaN(betAmount) || betAmount <= 0) {
            showModal('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!');
            return;
        }
        
        if (balance < betAmount) {
            showModal('‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE OA');
            return;
        }

        if (selected.size === 0) {
            showModal('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏Å‡πà‡∏≠‡∏ô!');
            return;
        }

        // 1. ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô
        const newBalanceAfterBet = balance - betAmount;
        await saveBalance(newBalanceAfterBet); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        
        rollButton.disabled = true;
        diceArea.textContent = 'üé≤ ‡∏´‡∏°‡∏∏‡∏ô...';
        result.textContent = '‡∏£‡∏≠‡∏•‡∏∏‡πâ‡∏ô‡∏ú‡∏•...';

        setTimeout(async () => {
            // 2. ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ 3 ‡∏•‡∏π‡∏Å
            const diceResults = [];
            for (let i = 0; i < 3; i++) {
                const index = Math.floor(Math.random() * animals.length);
                diceResults.push(animals[index]);
            }

            // 3. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤
            diceArea.innerHTML = diceResults.map(animal => emojis[animals.indexOf(animal)]).join(' ');

            // 4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•
            let hitCount = 0;
            diceResults.forEach(animal => {
                if (selected.has(animal)) {
                    hitCount++;
                }
            });

            let finalBalance;
            let winAmount = 0;
            let payoutRatio = 0;

            if (hitCount > 0) {
                // ** UPDATED LOGIC: ‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (Traditional Bau Cua Tom Ca) **
                // ‡∏ñ‡∏π‡∏Å 1 ‡∏ï‡∏±‡∏ß: ‡∏à‡πà‡∏≤‡∏¢ 1:1 (‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô + ‡∏Å‡∏≥‡πÑ‡∏£ 1 ‡πÄ‡∏ó‡πà‡∏≤) -> payoutRatio = 1
                // ‡∏ñ‡∏π‡∏Å 2 ‡∏ï‡∏±‡∏ß: ‡∏à‡πà‡∏≤‡∏¢ 1:2 (‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô + ‡∏Å‡∏≥‡πÑ‡∏£ 2 ‡πÄ‡∏ó‡πà‡∏≤) -> payoutRatio = 2
                // ‡∏ñ‡∏π‡∏Å 3 ‡∏ï‡∏±‡∏ß: ‡∏à‡πà‡∏≤‡∏¢ 1:3 (‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô + ‡∏Å‡∏≥‡πÑ‡∏£ 3 ‡πÄ‡∏ó‡πà‡∏≤) -> payoutRatio = 3
                if (hitCount === 1) payoutRatio = 1;
                else if (hitCount === 2) payoutRatio = 2;
                else if (hitCount >= 3) payoutRatio = 3;

                winAmount = betAmount * payoutRatio;
                finalBalance = newBalanceAfterBet + betAmount + winAmount; // (‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô) + (‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å) + (‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•)
                result.textContent = `üéâ ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞! ‡∏ñ‡∏π‡∏Å ${hitCount} ‡∏ï‡∏±‡∏ß (+${winAmount.toLocaleString()} üí∞)`;
                
            } else {
                // ‡πÅ‡∏û‡πâ: ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°
                finalBalance = newBalanceAfterBet;
                result.textContent = `üò≠ ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ! ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
            }

            // 5. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà
            await saveBalance(finalBalance);

            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°
            selected.clear();
            document.querySelectorAll('.animal-btn').forEach(btn => btn.classList.remove('selected'));
            
            rollButton.disabled = false;
        }, 1500);
    });

  </script>
</body>
</html>